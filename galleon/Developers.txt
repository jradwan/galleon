Notes for Galleon Developers
============================

After sending an email request to become a Galleon developer to
johnkohl@users.sourceforge.net, you will also be added to two mailing lists:
galleon-developers@lists.sourceforge.net: used for developer issues,
galleon-commits@lists.sourceforge.net: used by CVS to automatically post all checkins.
Both these mailing lists are archived on the project development page.

To help us keep track of who is doing what, we use the project bug and
feature trackers.  If you want to fix a particular bug or implement a
feature, assign it to yourself. If there are any new features you want
to work on, go ahead and add new features to the tracker.  If you decide
to do any significant development changes to Galleon it is recommended
that you use the mailing list to get feedback first.

I suggest that you read through the developer documentation provided by
SourceForge.  Everything you will need to know to use CVS and the
project tools are explained in detail.


Upgrading or adding Third-party components
------------------------------------------

1. Update ThirdPartyLicenses.txt as appropriate.  If the license is a
   common one, just add the new item to the list for that license.
   Include a URL where you got it.

   When adding java libraries to lib/, include the version number in the name

2. update the classpath used by Eclipse (add the jar file to the project
   build path)

3. update one or more of the following to ensure the jar files are
   included in the build and in the classpath at run-time:

   build.xml
   bin/win32/run.cmd
   distro/osx/bundles/Configure Galleon.app/Contents/Info.plist
   distro/osx/bundles/Galleon Server.app/Contents/Info.plist
   distro/win32/galleon.nsi

   (UNIX/Linux classpath just takes everything in the lib directory, no
   file to edit)

Building
--------
Galleon uses JDK 5

Ant build scripts are used to manage the build process (http://ant.apache.org).  
To compile the galleon.jar file:
ant compile

To build Galleon packages:

* Windows: run 'ant package' then use NSIS (nsis.sourceforge.net) to compile
  distro/win32/galleon.nsi
  to create distro/win32/Setup.exe
  (Very nice to use the NSIS eclipse plugin)
  http://eclipsensis.sourceforge.net/

* Linux: run 'distro/unix/build-zipfile.sh yes'
  (runs ant for you)
  generates galleon-<release>-linux.zip
  you can do this on OSX or Linux.

* OSX: run 'distro/osx/build-osx.sh yes'
  (runs ant for you)
  generates Galleon-<release>.dmg

  If the list of files has changed, you need to load Galleon-build.pmdoc
  (generated by distro/osx/build-osx.sh) into PackageMaker, re-load the
  contents, then patch the embedded absolute pathnames into
  /path/to/galleon form, then move the .xml files into Galleon.pmdoc
  before committing to the CVS repository.  (run
  distro/osx/pmdoc-cleanup.sh to do this cleanup)

To create a source copy:
ant source

To update the version number:

* Edit ReleaseNotes.txt to add a new section
* edit ./update-vno.sh to change the version numbers (set the old and
  new appropriately)
* run ./update-vno.sh (on UNIX, Linux or OSX)
  no args: previews and shows what it would change
  one arg: does the change
* commit the resulting changes

To create a release:

* Tag the sources in the CVS repository (cvs rtag GALLEON_x_y_z galleon)

* Create a new file release (sourceforge "Project admin" menu, "Downloads,
  then "Add release", name it x.y.z).  Copy the release notes section
  from ReleaseNotes.txt into the text box.

  Mark some old file releases hidden.

* Use the file management features at SourceForge to upload files.
  Documentation is linked from the "add release" page.

  Upload the Galleon-<release>.dmg, galleon-<release>.exe,
  galleon-<release>-linux.zip files, add them to the release
  Click "I'm sure" and notify subscribers

* Create a new news item on sourceforge.net (admin->news) titled
  "Galleon <release-number> for TiVo".
  https://sourceforge.net/news/admin/?group_id=126291

  That news item will trigger existing galleon installations to notify
  the owners that there's a new release.

* Update the top-level page at http://galleon.sourceforge.net/ (log in
  as a publishing account or the admin account at
  http://galleon.sourceforge.net/administrator).

* Update the download page:
  http://galleon.sourceforge.net/index.php?option=com_content&view=article&id=96&Itemid=57

galleon.sourceforge.net
-----------------------

galleon.sourceforge.net is a Joomla site for documentation and content
management.  It used to have forums but they're not working anymore.

* To add a user to publishing rights on galleon.sourceforge.net:

  visit http://galleon.sourceforge.net/administrator/
  Log in as administrator account (admin)
  Go to the user manager, find the user and/or add a new user as Registered.
  have new user change password and confirm ability to log in
  After confirmation, change user to Publisher privileges

  Joomla PHP files are on the SourceForge web server.  The ones that
  need to be writable (config files) are symlinked from the web server
  default mount area to a specific area that is writable to the web
  server account--the standard web pages are not writable.

  See SourceForge documentation on copying files to/from the web server
  <http://alexandria.wiki.sourceforge.net/Project+Web,+Shell,+VHOST+and+Database+Services>
  to manage the Joomla files themselves.  Best done on a MacOS or Linux
  host since they can replicate the necessary symlinks on your own disk.

  The back-end is a MySQL database configured through SourceForge.

  See SourceForge pages on the Galleon project page under Admin,
  Shell/DB/Web area, for the database user names, passwords, and hosts.

  [There is a stale VHOST for galleon.tv pointing to the old SourceForge
  servers.  SourceForge moved servers recently and this got broken, just
  after we converted references from galleon.tv to
  galleon.sourceforge.net.]

Winamp skins (text from ReleaseNotes.txt):

       The project has permission from the author of the Metrix Winamp classic
       skins (Sven Kistner) to distribute the skins with the Galleon project:

       http://www.winamp.com/skins/browse.php?search=yes&filter=S&query=metrix

       However, for copyright reasons, the skins are not checked into the
       project CVS. The Galleon build script will add any *.wsz Winamp skin
       files that are in the media/winamp directory to a package build. The
       Galleon GUI will detect any *.wsz files that are in the media/winamp
       directory and will allow the user to pick a skin in the music app
       configuration screen.

You need to have these files in your source directories to build
correctly-functioning distribution packages:

	./media/winamp/metrix.wsz
	./media/winamp/metrix_metal-dream.wsz
	./media/winamp/metrix_metal_dream_gold.wsz
	./media/winamp/metrix_metal_dream_green.wsz
	./media/winamp/metrix_metal_dream_red.wsz

Running
-------

Use the scripts in the bin directory to run the configuration GUI and
Galleon server.


Coding Style
------------
The Java code should conform to the Sun Java Coding conventions. 


Database
--------
Galleon uses Apache Derby (http://db.apache.org/derby/manuals/index.html) as an embedded database. However,
it can be replaced by any database supported by Hibernate (http://www.hibernate.org/80.html) by changing the conf/hibernate.properties file.

While the Galleon server is running, Derby runs as a network server, meaning that you can connect to it remotely.
You can use a program such as DBVisualizer (http://www.codework.com/dbvis/product.html) to connect to the Derby database. 
You can use the embedded driver or a JDBC driver (It is also possible to use ODBC: http://www-106.ibm.com/developerworks/db2/library/techarticle/dm-0409cline2/index.html) 

IBM provides a free JDBC driver:
http://www-128.ibm.com/developerworks/db2/downloads/jcc/

If you are using DBVisualiser, the driver jar files need to imported using the Tools/Driver Manager menu.
Use the following database URL to connect to Derby while Galleon is running using the DB2 driver:
jdbc:derby:net//localhost:1527/galleon
Use the following database URL to connect to Derby when Galleon is not running (using the path of the Galleon data dir) and using the embedded driver:
jdbc:derby:d:/galleon/data/galleon

userid: galleon
password: galleon

GUI
---
The GUI communicates with the server using Java RMI which binds to port 1099. This elliminates the proprietary 
socket connection that JavaHMO used. This will also allow headless systems to remotely configure the server.

Debugging
---------

To start the GUI in a debugger, use org.lnicholls.galleon.gui.Galleon.
Command line args are: [server-hostname [rmi-port]]

To start the server in a debugger, use
org.lnicholls.galleon.server.Server or org.lnicholls.galleon.server.OSXServer
Command line args are: [rmi-port]

If you specify a specific rmi-port, you can then run a production
Galleon and debug Galleon on the same host.  Some things don't work
quite right, though:
      * TiVo beacon for HMO/TTCB can't receive broadcast beacon events,
      it can only send them.  (Only one listener per host can bind the
      receive port.)  This means you need to add your TiVos manually to
      the ToGo list.

There are a few other classes that have public static void main()
routines, feel free to add more for unit testing.

Eclipse
-------

Eclipse makes a nice debug/development environment.
http://www.eclipse.org/

To check out Galleon in Eclipse through CVS:

* in the Eclipse Workbench, select Window -> Open Perspective -> Other

* select the "CVS Repository Exploring" perspective and click OK

* right-click in the CVS Repositories window and select New -> Repository Location

* in the "Add CVS Repository" dialog, fill in the following values
  - host: galleon.cvs.sourceforge.net
  - repository path: /cvsroot/galleon
  - user/password: your CVS credentials
  - connection type: ext

* click the "Configure connection preferences..." link and then click the "SSH2"
  link to configure your SSH connection

* fill in the "SSH2 home" path with the location of your private key and add a new
  private key filename if necessary

* click OK, then click Finish

* Eclipse will attempt to connect to the SourceForge CVS system and you should be
  prompted for your CVS password

* you should now be able to browse the Galleon CVS structure via the "CVS 
  Repositories" window on the Eclipse Workbench

* under HEAD, right click on galleon and select "Check Out"

* Eclipse will now check out all the source code and copy it to your specified 
  Eclipse workspace location

* you can now browse, edit (commit, compare, etc.) the Galleon code through the
  Package Explorer

Weather
-------
The Weather.com XML feed is used to obtain the weather data:
http://registration.weather.com/registration/xmloap/step1
To comply with the XML feed licence, the configuration GUI will include several links to the Weather.com site.


--------------------------------------
galleon.sourceforge.net
johnkohl@users.sourceforge.net
